From 2decc7daf64935cf8d8bd8d7f04fd2b259d46375 Mon Sep 17 00:00:00 2001
From: Nathan Chancellor <natechancellor@gmail.com>
Date: Sat, 3 Jun 2017 20:10:46 -0700
Subject: [PATCH] Allow adb root even in user builds

Change-Id: I507c6d90f0e355d8a931692f617b58b5f9eb6f20
Signed-off-by: Nathan Chancellor <natechancellor@gmail.com>
---
 adb/daemon/main.cpp | 4 ++--
 adb/services.cpp    | 8 --------
 2 files changed, 2 insertions(+), 10 deletions(-)

diff --git a/adb/daemon/main.cpp b/adb/daemon/main.cpp
index 4721e2f..194a667 100644
--- a/adb/daemon/main.cpp
+++ b/adb/daemon/main.cpp
@@ -100,9 +100,9 @@ static bool should_drop_privileges() {
         drop = true;
     }
 
-    return drop;
+    return false;
 #else
-    return true; // "adb root" not allowed, always drop privileges.
+    return false; // "adb root" not allowed, always drop privileges.
 #endif // ALLOW_ADBD_ROOT
 }
 
diff --git a/adb/services.cpp b/adb/services.cpp
index 3b212e9..7d38408 100644
--- a/adb/services.cpp
+++ b/adb/services.cpp
@@ -72,14 +72,6 @@ void restart_root_service(int fd, void *cookie) {
         WriteFdExactly(fd, "adbd is already running as root\n");
         adb_close(fd);
     } else {
-        char value[PROPERTY_VALUE_MAX];
-        property_get("ro.debuggable", value, "");
-        if (strcmp(value, "1") != 0) {
-            WriteFdExactly(fd, "adbd cannot run as root in production builds\n");
-            adb_close(fd);
-            return;
-        }
-
         property_set("service.adb.root", "1");
         WriteFdExactly(fd, "restarting adbd as root\n");
         adb_close(fd);
-- 
2.13.0


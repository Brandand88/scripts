# SPDX-License-Identifier: GPL-3.0-or-later
#
# Copyright (C) 2019 Nathan Chancellor
#
# Generic workstation environment setup script (usually for something like Vultr or Packet)
#
# Install zsh before hand and use 'chsh -s /bin/zsh $(whoami)'

function bootstrap() {(
    source <(curl -LSs https://github.com/nathanchance/scripts/raw/master/common) &>/dev/null || return 1

    # Get list of packages to be installed
    # Debian/Ubuntu
    if command -v apt &>/dev/null; then
        PACKAGES=( bison
                   build-essential
                   ca-certificates
                   clang
                   cmake
                   creduce
                   curl
                   doxygen
                   expect
                   file
                   flex
                   gcc
                   gcc-multilib
                   gettext
                   git
                   g++
                   libauthen-sasl-perl
                   libcurl4-openssl-dev
                   libedit-dev
                   libelf-dev
                   libemail-valid-perl
                   libevent-dev
                   libexpat1-dev
                   libglib2.0-dev
                   libgmp-dev
                   libio-socket-ssl-perl
                   libmailtools-perl
                   libmpc-dev
                   libmpfr-dev
                   libncurses-dev
                   libnet-smtp-ssl-perl
                   libpcre2-dev
                   libpixman-1-dev
                   libssl-dev
                   locales
                   make
                   mosh
                   most
                   neofetch
                   ninja-build
                   pkg-config
                   python3
                   python3-dev
                   ruby-dev
                   sudo
                   swig
                   texinfo
                   tcl
                   tmux
                   u-boot-tools
                   vim
                   zsh
                   zlib1g-dev )

        sudo_wrapper apt update || exit ${?}
        sudo_wrapper DEBIAN_FRONTEND=noninteractive apt upgrade -y || exit ${?}
        sudo_wrapper DEBIAN_FRONTEND=noninteractive apt install -y "${PACKAGES[@]}" || exit ${?}
        echo "locales locales/default_environment_locale select en_US.UTF-8" | sudo_wrapper debconf-set-selections
        echo "locales locales/locales_to_be_generated multiselect en_US.UTF-8 UTF-8" | sudo_wrapper debconf-set-selections
        sudo_wrapper rm "/etc/locale.gen"
        sudo_wrapper dpkg-reconfigure --frontend noninteractive locales
    fi

    SCRIPTS=${HOME}/github/scripts
    mkdir -p "${SCRIPTS%/*}"
    [[ -d ${SCRIPTS} ]] || { git clone https://github.com/nathanchance/scripts "${SCRIPTS}" || die "Error cloning scripts!"; }
    source "${SCRIPTS}"/env/setup && global_gitignore && create_zshrc
    source "${SCRIPTS}"/funcs/bldupdbin && { bldupdbin || exit ${?}; }
    path_push "${HOME}/usr/bin"
    source "${SCRIPTS}"/funcs/git && git_setup
    source "${SCRIPTS}"/funcs/pure && pure_prompt
    zsh "${SCRIPTS}"/configs/common/vim/vim_setup.sh
    ln -fs "${SCRIPTS}"/configs/workstation/.tmux.conf "${HOME}"/.tmux.conf

    # Download go on x86_64
    [[ $(get_arch) = "amd64" ]] && curl -LSs https://dl.google.com/go/go1.12.6.linux-amd64.tar.gz | tar -C ${HOME}/usr -xzf -
)}

function generic_aliases() {
    alias ls='ls --color=auto'
}

function generic_setup() {
    path_push "${HOME}"/usr/go/bin
}
# vi: filetype=zsh
